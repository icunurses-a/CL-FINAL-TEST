<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinical Laboratory FINAL</title>
    <style>
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --secondary: #06b6d4;
            --accent: #f59e0b;
            --success: #10b981;
            --error: #ef4444;
            --skip: #f59e0b; /* Orange for skip */
            --bg: #0f172a;
            --card-bg: #1e293b;
            --text: #f8fafc;
            --text-muted: #94a3b8;
            --font-main: 'Segoe UI', system-ui, sans-serif;
        }

        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            font-family: var(--font-main);
            background-color: var(--bg);
            color: var(--text);
            height: 100vh;
            overflow: hidden;
            display: flex; justify-content: center; align-items: center;
            background: radial-gradient(circle at 50% 50%, #1e293b 0%, #0f172a 100%);
        }

        /* --- Redesigned RGB Strobe Animation for "FINAL" --- */
        .final-title-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start; /* Keep left aligned like original */
        }

        .final-strobe {
            font-size: 3.5rem; /* MUCH BIGGER FONT */
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 5px;
            display: inline-block;
            margin-top: 5px;
            animation: neon-strobe 0.8s infinite alternate; /* Faster Strobe */
            line-height: 1;
            filter: contrast(1.2);
        }

        @keyframes neon-strobe {
            0% {
                color: #ff0000; /* RED */
                text-shadow: 
                    0 0 10px #ff0000,
                    0 0 20px #ff0000,
                    0 0 40px #ff0000,
                    0 0 80px #ff0000;
                transform: scale(1);
            }
            50% {
                color: #00ff00; /* GREEN */
                text-shadow: 
                    0 0 10px #00ff00,
                    0 0 20px #00ff00,
                    0 0 40px #00ff00,
                    0 0 80px #00ff00;
                transform: scale(1.05); /* Slight pulse up */
            }
            100% {
                color: #0000ff; /* BLUE */
                text-shadow: 
                    0 0 10px #0000ff,
                    0 0 20px #0000ff,
                    0 0 40px #0000ff,
                    0 0 80px #0000ff;
                transform: scale(1);
            }
        }

        /* --- Twinkle Effect for Stats --- */
        @keyframes twinkle {
            0% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.5); filter: brightness(1.5) drop-shadow(0 0 10px gold); }
            100% { transform: scale(1); filter: brightness(1); }
        }
        .stat-pop { animation: twinkle 0.4s ease-out; }

        /* --- Flash Overlay --- */
        #flash-overlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            pointer-events: none; z-index: 9999; opacity: 0;
            transition: opacity 0.3s ease-out;
        }
        .flash-correct { background-color: rgba(16, 185, 129, 0.4); animation: flashAnim 0.5s ease-out; }
        .flash-wrong { background-color: rgba(239, 68, 68, 0.4); animation: flashAnim 0.5s ease-out; }
        .flash-skip { background-color: rgba(245, 158, 11, 0.4); animation: flashAnim 0.5s ease-out; } 
        @keyframes flashAnim { 0% { opacity: 1; } 100% { opacity: 0; } }

        /* --- Main Container --- */
        #app-container { width: 100%; max-width: 900px; height: 95vh; display: flex; flex-direction: column; position: relative; }

        /* --- Header --- */
        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 0.5rem 1rem; background: rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .logo { font-size: 1.1rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; text-align: left;}
        
        .end-btn {
            background: var(--error); color: white; border: none; padding: 0.3rem 1rem;
            border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 0.8rem;
        }

        .stats-bar {
            display: flex; gap: 1rem; font-size: 0.9rem; font-weight: 600;
            background: rgba(0,0,0,0.3); padding: 0.5rem 1rem; border-radius: 8px;
        }
        .stat-item { display: flex; align-items: center; gap: 0.5rem; }

        /* --- Views --- */
        .view { flex: 1; display: none; flex-direction: column; padding: 1rem; overflow-y: auto; animation: fadeIn 0.4s ease-out; }
        .view.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Start Screen --- */
        #start-screen { justify-content: center; align-items: center; text-align: center; }
        h1 { font-size: 2.5rem; margin-bottom: 0.5rem; line-height: 1.1; }
        .subtitle { color: var(--text-muted); margin-bottom: 2rem; font-size: 1.1rem; }
        
        .mode-cards { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; width: 100%; margin-bottom: 2rem; }
        .mode-card {
            background: var(--card-bg); padding: 2rem; border-radius: 1rem; border: 2px solid transparent;
            cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column; align-items: center; gap: 1rem;
        }
        .mode-card:hover { border-color: var(--primary); transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        .mode-card.selected { border-color: var(--secondary); background: rgba(6, 182, 212, 0.1); }
        .mode-icon { font-size: 3rem; }

        .controls {
            background: var(--card-bg); padding: 1.5rem; border-radius: 1rem;
            width: 100%; max-width: 500px; display: flex; flex-direction: column; gap: 1rem;
        }
        label { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 0.25rem; display: block; text-align: left; }
        select, input[type="range"] { width: 100%; background: rgba(0,0,0,0.2); color: white; border: 1px solid rgba(255,255,255,0.2); padding: 0.5rem; border-radius: 0.5rem; }
        input[type="range"] { accent-color: var(--primary); border: none; }
        
        button.btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white; border: none; padding: 1rem 2rem; border-radius: 0.5rem;
            font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: transform 0.1s;
            width: 100%; margin-top: 1rem; box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4);
        }
        button.btn-primary:active { transform: scale(0.98); }

        /* --- Game Screen --- */
        .progress-container { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; margin-bottom: 0.5rem; overflow: hidden; }
        .progress-bar { height: 100%; background: var(--secondary); width: 0%; transition: width 0.3s ease; }

        .stress-timer-container {
            width: 100%; height: 4px; background: rgba(255,255,255,0.05); margin-bottom: 1rem;
            display: none;
        }
        .stress-bar { height: 100%; width: 100%; background: var(--success); transition: width 1s linear, background-color 1s; }

        .question-card {
            background: var(--card-bg); border-radius: 1rem; padding: 2rem; margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2); position: relative; min-height: 200px;
            display: flex; flex-direction: column; justify-content: center;
        }
        .subject-tag {
            position: absolute; top: 1rem; right: 1rem; font-size: 0.75rem;
            background: rgba(255,255,255,0.1); padding: 0.25rem 0.75rem; border-radius: 12px;
            color: var(--text-muted); text-transform: uppercase;
        }
        .question-text { font-size: 1.3rem; font-weight: 600; margin-bottom: 0; line-height: 1.5; }

        .options-grid { display: grid; gap: 1rem; }
        .option-btn {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            padding: 1rem; border-radius: 0.75rem; color: var(--text); text-align: left;
            font-size: 1rem; cursor: pointer; transition: all 0.2s; position: relative; overflow: hidden;
            display: flex; justify-content: space-between;
        }
        .option-btn:hover:not(:disabled) { background: rgba(255,255,255,0.1); border-color: var(--primary); }
        .option-btn.correct { background: rgba(16, 185, 129, 0.2); border-color: var(--success); color: #d1fae5; }
        .option-btn.wrong { background: rgba(239, 68, 68, 0.2); border-color: var(--error); color: #fee2e2; animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        .key-hint { font-size: 0.8rem; opacity: 0.5; font-weight: bold; background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        .feedback-area { min-height: 90px; margin-top: 1rem; padding: 1rem; border-radius: 0.5rem; display: none; animation: fadeIn 0.3s; }
        .feedback-area.show { display: block; }
        .feedback-correct { background: rgba(16, 185, 129, 0.1); border: 1px solid var(--success); color: #a7f3d0; }
        .feedback-wrong { background: rgba(239, 68, 68, 0.1); border: 1px solid var(--error); color: #fecaca; }
        .feedback-skip { background: rgba(245, 158, 11, 0.1); border: 1px solid var(--skip); color: #fcd34d; } 
        
        .emoji-display { font-size: 2rem; margin-right: 0.5rem; vertical-align: middle; }

        .action-buttons { display: flex; gap: 1rem; margin-top: 1rem; }
        
        .next-btn, .skip-btn {
            flex: 1; padding: 1rem; border: none; border-radius: 0.5rem; font-weight: bold; font-size: 1rem; cursor: pointer;
            display: none;
        }
        .next-btn.visible, .skip-btn.visible { display: block; }
        
        .next-btn { background: var(--text); color: var(--bg); }
        
        .skip-btn {
            background: rgba(255, 255, 255, 0.05);
            color: var(--skip);
            border: 2px dashed var(--skip);
        }
        .skip-btn:hover { background: rgba(245, 158, 11, 0.2); }
        .skip-hint { font-size: 0.7rem; opacity: 0.7; margin-left: 5px; text-transform: uppercase; letter-spacing: 1px;}

        /* --- Flashcard Specifics --- */
        .flashcard-container { perspective: 1000px; flex: 1; display: flex; justify-content: center; align-items: center; cursor: pointer; }
        .flashcard-inner { width: 100%; height: 350px; position: relative; transform-style: preserve-3d; transition: transform 0.6s; border-radius: 1rem; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .flashcard-inner.flipped { transform: rotateY(180deg); }
        .flashcard-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 2rem; border-radius: 1rem; background: var(--card-bg); border: 2px solid rgba(255,255,255,0.05); text-align: center; }
        .flashcard-back { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); transform: rotateY(180deg); border-color: var(--secondary); }
        .flashcard-rating { display: flex; gap: 1rem; margin-top: 1.5rem; opacity: 0; pointer-events: none; transition: opacity 0.3s; }
        .flashcard-inner.flipped .flashcard-rating { opacity: 1; pointer-events: auto; }
        .rate-btn { padding: 0.5rem 1.5rem; border: none; border-radius: 20px; cursor: pointer; font-weight: bold; }
        .rate-hard { background: var(--error); color: white; }
        .rate-easy { background: var(--success); color: white; }

        /* --- Report Screen --- */
        .report-header { text-align: center; margin-bottom: 2rem; }
        .score-circle { width: 150px; height: 150px; border-radius: 50%; border: 8px solid var(--primary); display: flex; flex-direction: column; justify-content: center; align-items: center; margin: 0 auto 1.5rem; background: rgba(79, 70, 229, 0.1); }
        .score-number { font-size: 3rem; font-weight: 800; }
        .score-label { font-size: 0.9rem; color: var(--text-muted); }
        .report-list { max-height: 40vh; overflow-y: auto; display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 1.5rem; }
        .report-item { background: rgba(255,255,255,0.03); padding: 0.75rem; border-radius: 0.5rem; border-left: 4px solid var(--text-muted); }
        .report-item.correct { border-left-color: var(--success); }
        .report-item.wrong { border-left-color: var(--error); }
        .report-item.skip { border-left-color: var(--skip); background: rgba(245, 158, 11, 0.05); } 
        
        .report-q { font-size: 0.9rem; font-weight: 600; margin-bottom: 0.25rem; }
        .report-a { font-size: 0.8rem; color: var(--text-muted); }
        .report-ans { font-size: 0.8rem; color: var(--accent); font-weight: bold; }

        /* Responsive */
        @media (max-width: 600px) {
            .mode-cards { grid-template-columns: 1fr; }
            .stats-bar { font-size: 0.7rem; flex-wrap: wrap; justify-content: center; gap: 0.5rem; }
            .question-text { font-size: 1.1rem; }
            .skip-hint { display: none; } /* Hide keyboard hint on mobile */
            .final-strobe { font-size: 2.5rem; } /* Slightly smaller on mobile to fit */
        }
    </style>
</head>
<body>

    <div id="flash-overlay"></div>

    <div id="app-container">
        <header>
            <div class="logo">
                <div class="final-title-container">
                    <div>Clinical Laboratory</div>
                    <span class="final-strobe">FINAL</span>
                </div>
            </div>
            <button class="end-btn" onclick="endGame()">END TEST</button>
        </header>

        <!-- Start Screen -->
        <main id="start-screen" class="view active">
            <h1>Clinical Lab Training</h1>
            <p class="subtitle">210 Questions ‚Ä¢ Immunoassay ‚Ä¢ Hematology ‚Ä¢ Genetics ‚Ä¢ Infection Control ‚Ä¢ POCT</p>

            <div class="mode-cards">
                <div class="mode-card" id="mode-quiz" onclick="selectMode('quiz')">
                    <div class="mode-icon">üß†</div>
                    <h3>Trivia Quiz</h3>
                    <p style="font-size: 0.8rem; color: var(--text-muted)">Timed mode. Keyboard support (A, B, C, D).</p>
                </div>
                <div class="mode-card" id="mode-flashcard" onclick="selectMode('flashcard')">
                    <div class="mode-icon">üé¥</div>
                    <h3>Flashcards</h3>
                    <p style="font-size: 0.8rem; color: var(--text-muted)">Study mode. Self-paced.</p>
                </div>
            </div>

            <div class="controls">
                <label>Number of Questions: <span id="q-count-val" class="range-value">20</span></label>
                <input type="range" id="q-count-range" min="5" max="210" value="20" step="5" oninput="updateRangeVal(this.value)">

                <label>Subject Focus:</label>
                <select id="subject-select">
                    <option value="all">All Subjects (Mixed)</option>
                    <option value="Subject 1">Subject 1: Immune System</option>
                    <option value="Subject 2">Subject 2: Immunoassay Principles</option>
                    <option value="Subject 3">Subject 3: Basic Hematology</option>
                    <option value="Subject 4">Subject 4: Blood Transfusion</option>
                    <option value="Subject 5">Subject 5: Genetics and Genomics</option>
                    <option value="Subject 6">Subject 6: Infection Control</option>
                    <option value="Subject 7">Subject 7: POCT</option>
                </select>

                <label>Stress Timer (Quiz Only):</label>
                <select id="timer-select">
                    <option value="0">No Limit</option>
                    <option value="10">10 Seconds per Question</option>
                    <option value="20">20 Seconds per Question</option>
                    <option value="30">30 Seconds per Question</option>
                    <option value="60">60 Seconds per Question</option>
                </select>

                <button class="btn-primary" onclick="startGame()">START CHALLENGE</button>
            </div>
        </main>

        <!-- Game Screen -->
        <main id="game-screen" class="view">
            <!-- Stats Header (Always Visible in Game) -->
            <div class="stats-bar" id="ingame-stats" style="opacity: 0; margin-bottom: 1rem;">
                <div class="stat-item">Q: <span id="stat-current">0</span>/<span id="stat-total">0</span></div>
                <div class="stat-item" style="color: var(--success)">‚úÖ <span id="stat-correct">0</span></div>
                <div class="stat-item" style="color: var(--error)">‚ùå <span id="stat-wrong">0</span></div>
                <div class="stat-item" style="color: var(--skip)">‚è≠ <span id="stat-skipped">0</span></div>
                <div class="stat-item" style="color: var(--secondary)">‚è±Ô∏è <span id="timer-display">00:00</span></div>
            </div>

            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            
            <div class="stress-timer-container" id="stress-timer-con">
                <div class="stress-bar" id="stress-bar"></div>
            </div>

            <!-- Quiz Layout -->
            <div id="quiz-layout" style="display: none; flex-direction: column; height: 100%;">
                <div class="question-card">
                    <span class="subject-tag" id="q-subject">Subject</span>
                    <div class="question-text" id="q-text">Question goes here?</div>
                </div>

                <div class="options-grid" id="options-container">
                    <!-- Options injected here -->
                </div>

                <div class="feedback-area" id="feedback-area">
                    <span class="emoji-display" id="fb-emoji"></span>
                    <strong id="feedback-title"></strong>
                    <p id="feedback-text" style="margin-top: 0.5rem; font-size: 0.9rem;"></p>
                </div>

                <div class="action-buttons">
                    <button class="skip-btn" id="skip-btn" onclick="skipQuestion()">Skip <span class="skip-hint">(S)</span></button>
                    <button class="next-btn" id="next-btn" onclick="nextQuestion()">Next Question ‚û° (Space)</button>
                </div>
            </div>

            <!-- Flashcard Layout -->
            <div id="flashcard-layout" style="display: none; flex-direction: column; height: 100%;">
                <div class="flashcard-container" onclick="flipCard()">
                    <div class="flashcard-inner" id="flashcard-inner">
                        <div class="flashcard-face">
                            <span class="subject-tag" id="fc-subject">Subject</span>
                            <div style="font-size: 1.3rem; font-weight: 600; margin-top: 1rem;" id="fc-question">Question?</div>
                            <p style="margin-top: 1rem; color: var(--secondary); font-size: 0.8rem;">(Tap to flip)</p>
                        </div>
                        <div class="flashcard-face flashcard-back">
                            <div style="font-size: 1.3rem; font-weight: 600; color: var(--success);" id="fc-answer">Answer</div>
                            
                            <div class="flashcard-rating">
                                <button class="rate-btn rate-hard" onclick="event.stopPropagation(); rateCard(false)">Hard</button>
                                <button class="rate-btn rate-easy" onclick="event.stopPropagation(); rateCard(true)">Easy</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Report Screen -->
        <main id="report-screen" class="view">
            <div class="report-header">
                <h2>Session Complete!</h2>
                <div class="score-circle">
                    <div class="score-number" id="final-percent">0%</div>
                    <div class="score-label">Accuracy</div>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: center; margin-bottom: 1rem;">
                    <div style="text-align: center;">
                        <div style="font-size: 1.5rem; color: var(--success);" id="final-correct">0</div>
                        <div style="font-size: 0.8rem;">Correct</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 1.5rem; color: var(--error);" id="final-wrong">0</div>
                        <div style="font-size: 0.8rem;">Incorrect</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 1.5rem; color: var(--skip);" id="final-skipped">0</div>
                        <div style="font-size: 0.8rem;">Skipped</div>
                    </div>
                </div>
            </div>

            <h3 style="border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 0.5rem;">Detailed Review</h3>
            <div class="report-list" id="report-list"></div>

            <button class="btn-primary" onclick="location.reload()">New Session</button>
        </main>
    </div>

    <script>
        /* 
         * DATA SECTION (All 210 Questions Verified)
         */
        const rawData = [
            // Subject 1: The Human Immune System
            ["Which system is responsible for protecting the body against infections and foreign substances?", "Respiratory System", "Immune System", "Circulatory System", "Nervous System", 1, "Subject 1"],
            ["Which branch of the immune system is present at birth?", "Innate Immune System", "Adaptive Immune System", "Acquired Immune System", "Humoral Immune System", 0, "Subject 1"],
            ["Which of the following is considered a component of the First Line of Defense?", "Inflammation", "Antibodies", "Intact Skin", "T-Cells", 2, "Subject 1"],
            ["Which cells are collectively known as phagocytes?", "Basophils and Eosinophils", "Neutrophils and Macrophages", "T-Cells and B-Cells", "Natural Killer Cells and Plasma Cells", 1, "Subject 1"],
            ["Which T-cells coordinate immune responses by releasing cytokines?", "Cytotoxic T cells (CD8+)", "Helper T cells (CD4+)", "Memory T cells", "Suppressor T cells", 1, "Subject 1"],
            ["Which type of immunity is acquired because of prior experience with a foreign substance?", "Innate", "Natural", "Adaptive", "Non-specific", 2, "Subject 1"],
            ["What is the function of B-cells?", "Engulf bacteria", "Produce antibodies", "Release histamine", "Destroy virus-infected cells directly", 1, "Subject 1"],
            ["Which antibody is the most abundant in the blood and crosses the placenta?", "IgA", "IgM", "IgG", "IgE", 2, "Subject 1"],
            ["Which antibody is found primarily in mucus, saliva, and tears?", "IgA", "IgG", "IgD", "IgM", 0, "Subject 1"],
            ["Which antibody is the first responder to an initial infection?", "IgG", "IgM", "IgE", "IgA", 1, "Subject 1"],
            ["Which antibody is associated with allergic reactions and parasitic infections?", "IgD", "IgG", "IgE", "IgM", 2, "Subject 1"],
            ["Which antibody functions mainly as a B-cell receptor?", "IgA", "IgD", "IgG", "IgE", 1, "Subject 1"],
            ["What is the process called where antibodies mark pathogens for destruction by other cells?", "Neutralization", "Agglutination", "Opsonization", "Lysis", 2, "Subject 1"],
            ["Which type of adaptive immunity involves antibodies passing from mother to fetus?", "Active Naturally Acquired", "Active Artificially Acquired", "Passive Naturally Acquired", "Passive Artificially Acquired", 2, "Subject 1"],
            ["Vaccination is an example of which type of immunity?", "Passive Natural", "Active Artificial", "Passive Artificial", "Active Natural", 1, "Subject 1"],
            ["How long does the primary immune response take to produce antibodies?", "1-2 days", "10-14 days", "4-6 weeks", "24 hours", 1, "Subject 1"],
            ["Which response produces a larger quantity of antibodies due to memory cells?", "Primary Response", "Secondary Response", "Innate Response", "Passive Response", 1, "Subject 1"],
            ["Type I hypersensitivity reactions (allergies) are mediated by which immunoglobulin?", "IgG", "IgM", "IgE", "IgA", 2, "Subject 1"],
            ["Which virus causes Acquired Immune Deficiency Syndrome (AIDS)?", "HPV", "HIV", "Influenza", "Varicella", 1, "Subject 1"],
            ["HIV primarily infects which type of cells?", "B-cells", "Neutrophils", "CD4+ T cells", "Platelets", 2, "Subject 1"],
            ["Which autoimmune disease involves inflammation of joints and surrounding tissues?", "Rheumatoid Arthritis", "Type 1 Diabetes", "Systemic Lupus Erythematosus", "Multiple Sclerosis", 0, "Subject 1"],
            ["What is the 'Butterfly rash' associated with?", "Rheumatoid Arthritis", "Systemic Lupus Erythematosus (SLE)", "Reactive Arthritis", "Diabetes", 1, "Subject 1"],
            ["Type 1 Diabetes is caused by the destruction of:", "Liver cells", "Insulin-producing cells in the pancreas", "Kidney nephrons", "Joint cartilage", 1, "Subject 1"],
            ["Which cells release histamine?", "Macrophages", "Mast cells and Basophils", "T-cells", "Dendritic cells", 1, "Subject 1"],
            ["The second line of defense includes all EXCEPT:", "Inflammation", "Fever", "Antibodies", "Phagocytes", 2, "Subject 1"],
            ["What enzyme-containing structure destroys pathogens inside a phagocyte?", "Ribosome", "Phagolysosome", "Nucleus", "Mitochondria", 1, "Subject 1"],
            ["What is the main function of Cytotoxic T cells (CD8+)?", "Produce antibodies", "Release histamine", "Destroy virus-infected or cancerous cells", "Coordinate the immune response", 2, "Subject 1"],
            ["Antihistamines are used to treat:", "Viral infections", "Allergies", "Bacterial infections", "Autoimmune diseases", 1, "Subject 1"],
            ["Which stem cell gives rise to Lymphocytes?", "Myeloid Progenitor", "Lymphoid Stem Cell", "Erythroblast", "Megakaryocyte", 1, "Subject 1"],
            ["Which of the following is NOT a sign of the innate immune response?", "Fever", "Inflammation", "Memory cell production", "Phagocytosis", 2, "Subject 1"],
            
            // Subject 2: Immunoassay Principles
            ["What is an immunoassay?", "A test to count blood cells", "A chemical test using antibody-antigen reactions", "A genetic sequencing test", "A bacterial culture test", 1, "Subject 2"],
            ["What forms when an antibody binds to a specific antigen?", "Immune Complex (Antigen-Antibody complex)", "Enzyme substrate", "Lipid bilayer", "Protein chain", 0, "Subject 2"],
            ["Monoclonal antibodies bind to:", "Multiple sites on an antigen", "One specific antigenic site (epitope)", "Any foreign protein", "Non-specific receptors", 1, "Subject 2"],
            ["Which antibodies are cheaper to produce but less specific?", "Monoclonal", "Polyclonal", "Hybridoma", "Synthetic", 1, "Subject 2"],
            ["What does ELISA stand for?", "Enzyme-Linked Immune System Assessment", "Enzyme-Linked Immunosorbent Assay", "Enzyme-Loop Immuno-Sorbent Antibody", "Electronic Light Immuno-System Analysis", 1, "Subject 2"],
            ["In ELISA, what is measured to determine antigen concentration?", "Radioactivity", "Color intensity", "Light emission", "Precipitate weight", 1, "Subject 2"],
            ["In Chemiluminescence Immunoassay (CHLIA), the label emits:", "Color", "Light", "Heat", "Sound", 1, "Subject 2"],
            ["Which instrument measures the light intensity in CHLIA?", "Spectrophotometer", "Luminometer", "Microscope", "Thermometer", 1, "Subject 2"],
            ["In a Sandwich Assay, the antigen is bound between:", "Two antigens", "A capture antibody and a detection antibody", "An enzyme and a substrate", "A solid surface and a dye", 1, "Subject 2"],
            ["Which assay type is commonly used for small molecules with only one binding site?", "Sandwich Assay", "Competitive Assay", "Direct ELISA", "Western Blot", 1, "Subject 2"],
            ["In a Competitive Assay, the signal strength is:", "Directly proportional to analyte concentration", "Inversely proportional to analyte concentration", "Unrelated to concentration", "Equal to the control", 1, "Subject 2"],
            ["What is the 'Capture Antibody' attached to in a Sandwich ELISA?", "The detection enzyme", "A solid surface (e.g., microplate well)", "The patient sample", "The substrate", 1, "Subject 2"],
            ["Immunoassays can detect antigens in:", "High concentrations only", "Extremely low concentrations", "Solid tissues only", "Bacterial cultures only", 1, "Subject 2"],
            ["Which of the following is an application of immunoassays?", "Hormone analysis (e.g., TSH)", "Disease diagnosis (e.g., HIV)", "Drug testing", "All of the above", 3, "Subject 2"],
            ["What is the function of the substrate in an ELISA?", "To bind the antigen", "To react with the enzyme and produce a color change", "To wash away unbound proteins", "To stop the reaction", 1, "Subject 2"],
            ["Which antibodies provide high specificity and reproducibility?", "Polyclonal", "Monoclonal", "Autoantibodies", "Cross-reacting antibodies", 1, "Subject 2"],
            ["What is the 'Analyte' in an immunoassay?", "The enzyme", "The antibody", "The substance being measured (Antigen)", "The buffer solution", 2, "Subject 2"],
            ["If a patient sample has a high concentration of antigen in a Sandwich ELISA, the color intensity will be:", "Low", "High", "Zero", "Colorless", 1, "Subject 2"],
            ["Which test is used for autoimmune antibody detection (e.g., ANA)?", "CBC", "Immunoassay", "PCR", "Electrophoresis", 1, "Subject 2"],
            ["Cortisol and drug levels are often tested using which method?", "Sandwich Assay", "Competitive Assay", "Agglutination", "Precipitation", 1, "Subject 2"],
            ["The part of the antigen that the antibody binds to is called the:", "Paratope", "Epitope", "Isotype", "Haptoglobin", 1, "Subject 2"],
            ["What happens if the 'Wash' step is skipped in ELISA?", "The results will be more accurate", "Unbound antibodies may cause false positives (background noise)", "The color will not develop", "The plate will crack", 1, "Subject 2"],
            ["CHLIA is known for being:", "Slow and insensitive", "Highly sensitive and rapid", "Only qualitative", "Manual only", 1, "Subject 2"],
            ["What does the 'Detection Antibody' usually carry in a Sandwich ELISA?", "The antigen", "An enzyme or label", "The solid phase", "The patient sample", 1, "Subject 2"],
            ["Which of the following is NOT a component of blood plasma?", "Water", "Albumin", "Platelets", "Electrolytes", 2, "Subject 2"],
            ["What is the first step in a Sandwich ELISA?", "Adding the substrate", "Capture antibody is fixed to the surface", "Adding the detection antibody", "Adding the stop solution", 1, "Subject 2"],
            ["A qualitative ELISA result provides:", "An exact concentration number", "A Positive or Negative result", "A graph of reaction kinetics", "A DNA sequence", 1, "Subject 2"],
            ["Which protein is the most abundant in plasma?", "Fibrinogen", "Albumin", "Globulin", "Hemoglobin", 1, "Subject 2"],
            ["Which sample type is most common for immunoassays?", "Whole blood", "Serum or Plasma", "Hair", "Skin scraping", 1, "Subject 2"],
            ["'More patient antigen = Lower signal' describes which assay?", "Sandwich", "Direct", "Competitive", "Indirect", 2, "Subject 2"],

            // Subject 3: Basic Hematology
            ["Hematology is the study of:", "The heart", "Blood and blood-forming organs", "The liver", "Hormones", 1, "Subject 3"],
            ["What percentage of whole blood is Plasma?", "45%", "55%", "90%", "10%", 1, "Subject 3"],
            ["Which formed element is responsible for oxygen transport?", "Leukocytes", "Erythrocytes (RBCs)", "Thrombocytes", "Plasma proteins", 1, "Subject 3"],
            ["What is the normal life span of a Red Blood Cell?", "10 days", "120 days", "24 hours", "1 year", 1, "Subject 3"],
            ["The 'Buffy Coat' in a centrifuged blood sample contains:", "RBCs only", "Plasma", "WBCs and Platelets", "Serum", 2, "Subject 3"],
            ["Which protein in RBCs binds oxygen?", "Albumin", "Hemoglobin", "Fibrinogen", "Globulin", 1, "Subject 3"],
            ["What is the main function of Neutrophils?", "Produce antibodies", "Phagocytosis of bacteria", "Clotting", "Transport CO2", 1, "Subject 3"],
            ["Which WBC is increased in parasitic infections and allergies?", "Neutrophil", "Eosinophil", "Monocyte", "Lymphocyte", 1, "Subject 3"],
            ["Which cells produce antibodies?", "T-lymphocytes", "B-lymphocytes", "Monocytes", "Basophils", 1, "Subject 3"],
            ["Platelets are derived from which bone marrow cell?", "Erythroblast", "Megakaryocyte", "Myeloblast", "Lymphoblast", 1, "Subject 3"],
            ["What is the normal platelet count?", "4,000-11,000 /mm¬≥", "150,000-400,000 /mm¬≥", "4.5-5.5 million /mm¬≥", "500-1000 /mm¬≥", 1, "Subject 3"],
            ["A decrease in RBC count or hemoglobin is called:", "Polycythemia", "Anemia", "Leukocytosis", "Thrombocytosis", 1, "Subject 3"],
            ["Which tube is used for a Complete Blood Count (CBC)?", "Green top (Heparin)", "Lavender top (EDTA)", "Red top (Plain)", "Blue top (Citrate)", 1, "Subject 3"],
            ["What is the function of EDTA in the collection tube?", "Promotes clotting", "Prevents clotting (Anticoagulant)", "Separates serum", "Preserves glucose", 1, "Subject 3"],
            ["Which organ is known as the 'graveyard of RBCs'?", "Liver", "Spleen", "Kidney", "Heart", 1, "Subject 3"],
            ["RBCs are:", "Nucleated and spherical", "Anucleate and biconcave", "Nucleated and biconcave", "Anucleate and irregular", 1, "Subject 3"],
            ["An increase in Neutrophils usually indicates:", "Bacterial infection", "Viral infection", "Allergy", "Parasitic infection", 0, "Subject 3"],
            ["What is Hematocrit?", "The total volume of blood", "The percentage of blood volume occupied by RBCs", "The weight of hemoglobin", "The number of WBCs", 1, "Subject 3"],
            ["Which WBC releases histamine and heparin?", "Eosinophil", "Basophil", "Monocyte", "Lymphocyte", 1, "Subject 3"],
            ["Monocytes differentiate into which tissue cell?", "Mast cell", "Macrophage", "Plasma cell", "Platelet", 1, "Subject 3"],
            ["Low platelet count is termed:", "Thrombocytosis", "Thrombocytopenia", "Leukopenia", "Anemia", 1, "Subject 3"],
            ["Ideally, a CBC sample should be analyzed within:", "2 hours", "24 hours", "48 hours", "1 week", 1, "Subject 3"],
            ["Which test screens for inflammation?", "Hemoglobin", "Erythrocyte Sedimentation Rate (ESR)", "RBC count", "Platelet count", 1, "Subject 3"],
            ["Correct mixing of an EDTA tube involves:", "Shaking vigorously", "Gentle inversion 8-10 times", "Rolling on the table", "No mixing needed", 1, "Subject 3"],
            ["Polycythemia refers to:", "Low RBCs", "Increased RBC count", "Low Platelets", "High WBCs", 1, "Subject 3"],
            ["Leukemia is defined as:", "Low WBC count", "Uncontrolled proliferation of abnormal WBCs", "Bacterial infection of blood", "Lack of platelets", 1, "Subject 3"],
            ["The main protein responsible for osmotic pressure in plasma is:", "Fibrinogen", "Albumin", "Globulin", "Hemoglobin", 1, "Subject 3"],
            ["Sickle cells are found in:", "Iron deficiency anemia", "Sickle cell anemia", "Leukemia", "Spherocytosis", 1, "Subject 3"],
            ["The normal WBC count is:", "4,000-11,000 /mm¬≥", "150,000-400,000 /mm¬≥", "4-6 million /mm¬≥", "500-1000 /mm¬≥", 0, "Subject 3"],
            ["Hemolysis in a sample can cause:", "Accurate results", "False results", "Better cell preservation", "Clotting", 1, "Subject 3"],

            // Subject 4: Blood Transfusion
            ["Who discovered the ABO blood group system?", "Louis Pasteur", "Karl Landsteiner", "Robert Koch", "James Blundell", 1, "Subject 4"],
            ["Which blood group is considered the 'Universal Donor' for RBCs?", "Group A", "Group B", "Group AB", "Group O", 3, "Subject 4"],
            ["Which blood group is the 'Universal Recipient' for RBCs?", "Group A", "Group B", "Group AB", "Group O", 2, "Subject 4"],
            ["Landsteiner's Law states that if an antigen is present on RBCs:", "The corresponding antibody must be present in plasma", "The corresponding antibody must be absent from plasma", "The person is sick", "The person is Rh positive", 1, "Subject 4"],
            ["A person with Blood Group A has:", "B antigens and Anti-A antibodies", "A antigens and Anti-B antibodies", "A and B antigens", "No antigens", 1, "Subject 4"],
            ["The Rh system is named after which antigen?", "A antigen", "D antigen", "M antigen", "K antigen", 1, "Subject 4"],
            ["Hemolytic Disease of the Newborn (HDN) typically occurs when:", "Mother is Rh+ and Baby is Rh-", "Mother is Rh- and Baby is Rh+", "Both are Rh-", "Both are Rh+", 1, "Subject 4"],
            ["What is given to an Rh-negative mother to prevent HDN?", "Antibiotics", "Rh Immunoglobulin (Anti-D)", "Blood transfusion", "Steroids", 1, "Subject 4"],
            ["Which test compares donor RBCs with recipient serum?", "Major Crossmatch", "Minor Crossmatch", "Direct Coombs Test", "CBC", 0, "Subject 4"],
            ["The 'Bombay Phenotype' lacks which antigen?", "A antigen", "B antigen", "H antigen", "D antigen", 2, "Subject 4"],
            ["People with Bombay blood group can receive blood from:", "Group O donors", "Other Bombay phenotype donors only", "Group AB donors", "Any donor", 1, "Subject 4"],
            ["Which anticoagulant is commonly used in blood bags?", "EDTA", "Heparin", "CPDA-1 (Citrate Phosphate Dextrose Adenine)", "Oxalate", 2, "Subject 4"],
            ["What is the minimum age for blood donation?", "16 years", "18 years", "21 years", "25 years", 1, "Subject 4"],
            ["A donor weighing 50 kg can donate approximately:", "350 mL", "450 mL", "500 mL", "250 mL", 1, "Subject 4"],
            ["How long must a donor wait after a Malaria infection?", "1 month", "3 months", "1 year", "Permanently deferred", 2, "Subject 4"],
            ["History of Jaundice defers a donor for:", "6 months", "1 year", "5 years", "Permanently", 1, "Subject 4"],
            ["Which infection results in permanent deferral from donation?", "Influenza", "HIV or Hepatitis B/C", "Chickenpox", "Diarrhea", 1, "Subject 4"],
            ["Which blood group system provides natural protection against Malaria?", "ABO", "Duffy (absence of antigen)", "Kell", "Kidd", 1, "Subject 4"],
            ["Which antibodies are 'warm antibodies' (IgG)?", "ABO antibodies", "Rh antibodies", "Lewis antibodies", "IgM antibodies", 1, "Subject 4"],
            ["The purpose of crossmatching is to:", "Check for viruses", "Ensure compatibility between donor and recipient", "Determine the expiration date", "Measure hemoglobin", 1, "Subject 4"],
            ["Fresh Frozen Plasma (FFP) contains:", "RBCs only", "Platelets only", "Coagulation factors", "White blood cells", 2, "Subject 4"],
            ["Anti-A and Anti-B antibodies are usually which class?", "IgG", "IgM", "IgE", "IgA", 1, "Subject 4"],
            ["Which blood component is stored at room temperature (with agitation)?", "Red Blood Cells", "Platelets", "Plasma", "Cryoprecipitate", 1, "Subject 4"],
            ["The term 'autologous transfusion' means:", "Receiving blood from a relative", "Receiving one's own blood", "Receiving synthetic blood", "Receiving animal blood", 1, "Subject 4"],
            ["What is the maximum body temperature allowed for a donor?", "36.5¬∞C", "37.5¬∞C", "38.0¬∞C", "39.0¬∞C", 1, "Subject 4"],
            ["Minor crossmatch compares:", "Donor RBCs + Recipient Serum", "Donor Serum + Recipient RBCs", "Donor RBCs + Donor Serum", "Recipient RBCs + Recipient Serum", 1, "Subject 4"],
            ["Which blood group has NO antigens on the RBC surface?", "Group A", "Group AB", "Group O", "Group B", 2, "Subject 4"],
            ["The Kell blood group antibodies (Anti-K) are:", "Common", "Capable of causing transfusion reactions", "Harmless", "Only IgM", 1, "Subject 4"],
            ["Apheresis is a process that:", "Tests for HIV", "Selectively extracts specific blood components", "Freezes blood", "Destroys WBCs", 1, "Subject 4"],
            ["Syphilis testing is performed on donor blood using:", "Serologic tests", "Blood culture", "Smear microscopy", "Genetic testing", 0, "Subject 4"],

            // Subject 5: Introduction to Genetics and Genomics
            ["What is the molecular instruction manual of the body?", "RNA", "DNA", "Protein", "Enzyme", 1, "Subject 5"],
            ["How many pairs of chromosomes do humans have?", "20", "23", "46", "12", 1, "Subject 5"],
            ["The actual genetic makeup of an individual is called the:", "Phenotype", "Genotype", "Karyotype", "Haplotype", 1, "Subject 5"],
            ["The observable characteristics (e.g., eye color) are called the:", "Genotype", "Phenotype", "Allele", "Mutation", 1, "Subject 5"],
            ["Humans share what percentage of their DNA sequence?", "50%", "75%", "99.9%", "10%", 2, "Subject 5"],
            ["Which inheritance pattern requires only one mutated copy for disease expression?", "Autosomal Recessive", "Autosomal Dominant", "X-Linked", "Mitochondrial", 1, "Subject 5"],
            ["Cystic Fibrosis is an example of which inheritance pattern?", "Autosomal Dominant", "Autosomal Recessive", "X-Linked", "Y-Linked", 1, "Subject 5"],
            ["In X-linked inheritance, who is primarily affected?", "Females", "Males", "Both equally", "Neither", 1, "Subject 5"],
            ["Which mutation creates a premature stop codon?", "Missense", "Nonsense", "Silent", "Frameshift", 1, "Subject 5"],
            ["BRCA1 and BRCA2 genes are:", "Oncogenes", "Tumor suppressor genes", "Viral genes", "Metabolic genes", 1, "Subject 5"],
            ["A 'Frameshift Mutation' involves:", "Single base change", "Insertion or deletion not divisible by three", "No change in amino acid", "Stop codon creation", 1, "Subject 5"],
            ["BRCA1 mutations significantly increase the risk of:", "Lung cancer", "Breast and Ovarian cancer", "Liver cancer", "Bone cancer", 1, "Subject 5"],
            ["What is 'Pharmacogenomics'?", "Study of pharmacy", "Study of how genes affect drug response", "Study of gene therapy", "Study of viruses", 1, "Subject 5"],
            ["Which enzyme system metabolizes 75% of medications?", "Cytochrome P450 (CYP450)", "Amylase", "Lipase", "Polymerase", 0, "Subject 5"],
            ["Polymerase Chain Reaction (PCR) is used to:", "Separate proteins", "Amplify specific DNA segments", "Measure blood pressure", "Count cells", 1, "Subject 5"],
            ["What does a 'VUS' result mean in genetic testing?", "Very Useful Sequence", "Variant of Uncertain Significance", "Verified Unsafe Sample", "Virus Under Study", 1, "Subject 5"],
            ["Which law protects against genetic discrimination by employers?", "HIPAA", "GINA (Genetic Information Nondiscrimination Act)", "OSHA", "FDA", 1, "Subject 5"],
            ["A 'Previvor' is:", "A cancer survivor", "Someone with a genetic risk who has not developed the disease", "A gene carrier who is immune", "A donor", 1, "Subject 5"],
            ["Prophylactic surgery (e.g., mastectomy) is a form of:", "Treatment", "Risk-reduction intervention", "Diagnostic test", "Chemotherapy", 1, "Subject 5"],
            ["Warfarin dosing can be influenced by variants in which genes?", "BRCA1", "VKORC1 and CYP2C9", "HLA-B27", "CFTR", 1, "Subject 5"],
            ["Lynch syndrome increases the risk of:", "Breast cancer", "Colorectal and Endometrial cancer", "Lung cancer", "Skin cancer", 1, "Subject 5"],
            ["Whole Exome Sequencing analyzes:", "The entire genome", "Protein-coding regions (~1%)", "Only mitochondria", "Only introns", 1, "Subject 5"],
            ["HLA-B27 is associated with:", "Diabetes", "Ankylosing Spondylitis", "HIV resistance", "Malaria", 1, "Subject 5"],
            ["Which blood type shows some protection against severe COVID-19?", "Type A", "Type O", "Type AB", "Type B", 1, "Subject 5"],
            ["CCR5-delta32 mutation provides resistance to:", "Malaria", "HIV infection", "Flu", "Cancer", 1, "Subject 5"],
            ["A pedigree of how many generations is essential for genetic assessment?", "One", "Two", "Three", "Five", 2, "Subject 5"],
            ["Gel Electrophoresis separates DNA based on:", "Color", "Size", "Shape", "Temperature", 1, "Subject 5"],
            ["'Cascade testing' refers to:", "Testing water", "Testing relatives of a person with a positive genetic result", "Testing for multiple diseases", "Repeat testing", 1, "Subject 5"],
            ["Most human genetic diversity is contained in what percentage of DNA?", "10%", "50%", "0.1%", "1%", 2, "Subject 5"],
            ["Consanguinity (mating between relatives) increases the risk of:", "Autosomal Dominant disorders", "Autosomal Recessive disorders", "Viral infections", "X-linked disorders", 1, "Subject 5"],

            // Subject 6: Infection Control & Biosafety
            ["What is the single most important measure to prevent infection?", "Wearing gloves", "Hand Hygiene", "Wearing a mask", "Isolation", 1, "Subject 6"],
            ["Standard Precautions apply to:", "Only infectious patients", "All patients regardless of diagnosis", "Only HIV patients", "Only surgical patients", 1, "Subject 6"],
            ["How long should you wash your hands with soap and water?", "5 seconds", "At least 20 seconds", "1 minute", "10 seconds", 1, "Subject 6"],
            ["Which PPE is used for 'Airborne Precautions'?", "Surgical Mask", "N95 Respirator", "Cloth mask", "Face shield only", 1, "Subject 6"],
            ["Hepatitis B is transmitted primarily through:", "Respiratory droplets", "Blood and body fluids", "Contaminated food", "Casual contact", 1, "Subject 6"],
            ["Most hospital clinical laboratories operate at which Biosafety Level?", "BSL-1", "BSL-2", "BSL-3", "BSL-4", 1, "Subject 6"],
            ["Which bin color is used for biohazardous/infectious waste?", "Black", "Red", "Yellow", "Blue", 1, "Subject 6"],
            ["Yellow bags are typically used for:", "General waste", "Chemotherapy and chemical waste", "Sharps", "Paper", 1, "Subject 6"],
            ["When doffing (removing) PPE, which item is removed first?", "Mask", "Gown", "Gloves (most contaminated)", "Goggles", 2, "Subject 6"],
            ["Recapping needles is:", "Recommended", "Generally prohibited (unless using one-handed scoop)", "Mandatory", "Safe", 1, "Subject 6"],
            ["Sharps containers should be replaced when they are:", "Full", "2/3 full", "Empty", "Overflowing", 1, "Subject 6"],
            ["Immediate first aid for a needlestick injury is:", "Squeeze the wound", "Wash with soap and water", "Apply bleach", "Bandage immediately", 1, "Subject 6"],
            ["What is the correct order for Donning (putting on) PPE?", "Gloves, Gown, Mask, Eye Protection", "Gown, Mask, Eye Protection, Gloves", "Mask, Gloves, Gown, Eye Protection", "Gloves, Mask, Gown", 1, "Subject 6"],
            ["Contact Precautions are used for:", "Tuberculosis", "MRSA, C. difficile", "Influenza", "Measles", 1, "Subject 6"],
            ["Alcohol-based hand rub is ineffective against:", "HIV", "C. difficile spores", "Influenza", "Staphylococcus", 1, "Subject 6"],
            ["What does PPE stand for?", "Personal Prevention Equipment", "Personal Protective Equipment", "Private Protective Exam", "Public Prevention Equipment", 1, "Subject 6"],
            ["Which device protects personnel from aerosols in the lab?", "Fume Hood", "Biological Safety Cabinet (BSC)", "Autoclave", "Centrifuge", 1, "Subject 6"],
            ["How long is the contact time for 10% bleach on a spill?", "1 minute", "10-20 minutes", "1 hour", "5 seconds", 1, "Subject 6"],
            ["Universal biohazard symbol warns of:", "Radiation", "Infectious material", "Poison", "Electricity", 1, "Subject 6"],
            ["Post-Exposure Prophylaxis (PEP) for HIV should start within:", "2 hours", "24 hours", "72 hours", "1 week", 2, "Subject 6"],
            ["Which vaccine is mandatory for healthcare workers handling blood?", "Hepatitis B", "Hepatitis C", "HIV", "Malaria", 0, "Subject 6"],
            ["What is a 'Near-miss'?", "An accident with injury", "An incident that could have caused harm but didn't", "A protocol violation", "A patient complaint", 1, "Subject 6"],
            ["In the Chain of Infection, vaccination breaks which link?", "Portal of Exit", "Susceptible Host", "Mode of Transmission", "Reservoir", 1, "Subject 6"],
            ["Double gloving is recommended for:", "All procedures", "High-risk procedures (e.g., surgery, chemo)", "Patient transport", "Documentation", 1, "Subject 6"],
            ["Which agent requires BSL-3 precautions?", "E. coli", "Mycobacterium tuberculosis", "Staphylococcus aureus", "Ebola (BSL-4)", 1, "Subject 6"],
            ["A 'Nosocomial infection' is:", "Community-acquired", "Healthcare-associated (HAI)", "Genetic", "Allergic", 1, "Subject 6"],
            ["Safety showers must be within how many seconds of a hazard?", "10 seconds", "1 minute", "5 minutes", "Next floor", 0, "Subject 6"],
            ["What is the ratio for bleach solution used on spills?", "1:100", "1:10 (10%)", "1:1", "Pure bleach", 1, "Subject 6"],
            ["Never pipette by:", "Hand", "Mouth", "Machine", "Bulb", 1, "Subject 6"],
            ["Who is responsible for Infection Control?", "The doctors only", "The cleaners only", "Everyone (Nurses, Doctors, Staff)", "The government", 2, "Subject 6"],

            // Subject 7: Point-of-Care Testing (POCT)
            ["What is Point-of-Care Testing (POCT)?", "Testing done in a central lab", "Testing performed at or near the site of patient care", "Testing done by mail", "Research testing", 1, "Subject 7"],
            ["A major advantage of POCT is:", "Lower cost per test", "Rapid results (minutes)", "Higher complexity", "Larger sample volume", 1, "Subject 7"],
            ["Which is a common POCT application?", "Blood Glucose monitoring", "DNA sequencing", "MRI", "Biopsy", 0, "Subject 7"],
            ["The preferred site for adult fingerstick is:", "Thumb", "Lateral side of 3rd or 4th finger", "Index finger", "Center of fingertip", 1, "Subject 7"],
            ["For infants, the collection site is:", "Finger", "Lateral/Medial plantar surface of heel", "Ear lobe", "Toe", 1, "Subject 7"],
            ["Why must alcohol dry completely before puncture?", "To reduce pain", "To prevent hemolysis and sample dilution", "To warm the skin", "To clot the blood", 1, "Subject 7"],
            ["What is the first step after puncturing the skin?", "Collect the blood", "Wipe away the first drop", "Apply bandage", "Squeeze hard", 1, "Subject 7"],
            ["Excessive squeezing of the finger causes:", "Better flow", "Hemolysis and tissue fluid contamination", "Less pain", "Clotting", 1, "Subject 7"],
            ["Quality Control (QC) in POCT ensures:", "The device is clean", "Accuracy and reliability of results", "The battery is full", "The patient is happy", 1, "Subject 7"],
            ["A 'Critical Value' requires:", "Documentation only", "Immediate notification of physician and intervention", "Repeating the test next day", "Ignoring", 1, "Subject 7"],
            ["If a POCT glucometer shows 'Error', what is the first step?", "Give insulin", "Troubleshoot (check strip, battery, retest)", "Call the lab", "Guess the result", 1, "Subject 7"],
            ["Which test monitors Warfarin therapy?", "Glucose", "INR/PT", "Troponin", "Hemoglobin", 1, "Subject 7"],
            ["Troponin is a marker for:", "Kidney failure", "Acute Myocardial Infarction (Heart Attack)", "Liver disease", "Diabetes", 1, "Subject 7"],
            ["Which urine test parameter indicates a UTI?", "Glucose", "Leukocytes and Nitrites", "Ketones", "Bilirubin", 1, "Subject 7"],
            ["Normal fasting blood glucose range is approximately:", "70-100 mg/dL", "20-50 mg/dL", "150-200 mg/dL", ">200 mg/dL", 0, "Subject 7"],
            ["What is the maximum puncture depth for an infant heelstick?", "5 mm", "2.0 mm", "1 mm", "10 mm", 1, "Subject 7"],
            ["SBAR stands for:", "Stop, Breathe, Act, Report", "Situation, Background, Assessment, Recommendation", "Safety, Biosafety, Action, Result", "Standard, Basic, Advanced, Review", 1, "Subject 7"],
            ["Which anticoagulant causes a false elevation of Potassium?", "Citrate", "Heparin", "Hemolysis (not an anticoagulant, but a collection error)", "EDTA", 2, "Subject 7"],
            ["Hypoglycemia treatment rule of thumb is:", "Wait and see", "Give 15-20g fast-acting carbohydrate", "Give Insulin", "Give Water", 1, "Subject 7"],
            ["Lateral flow assays (like pregnancy tests) provide:", "Quantitative results", "Qualitative (Pos/Neg) results", "DNA analysis", "Cell counts", 1, "Subject 7"],
            ["'Milking' the finger refers to:", "Gentle massage", "Strong repetitive squeezing (should be avoided)", "Warming", "Cleaning", 1, "Subject 7"],
            ["POCT waste (strips, lancets) goes into:", "Regular trash", "Biohazard/Sharps container", "Recycle bin", "Sink", 1, "Subject 7"],
            ["If a critical potassium level (6.8 mmol/L) is found:", "Recheck in 24 hours", "Obtain ECG and notify physician immediately", "Give potassium supplements", "Send patient home", 1, "Subject 7"],
            ["Elevated Lactate (>2 mmol/L) suggests:", "Diabetes", "Sepsis / Tissue hypoperfusion", "Anemia", "Hypertension", 1, "Subject 7"],
            ["Who is responsible for operator competency in POCT?", "Manufacturer", "The facility/Nurse Manager", "Patient", "Insurance", 1, "Subject 7"],
            ["Dehydration can cause false elevation of:", "Hemoglobin and Hematocrit", "Glucose", "WBCs", "Platelets", 0, "Subject 7"],
            ["Which patient population is ideal for capillary sampling?", "Severe edema", "Pediatric/Infants", "Shock (poor perfusion)", "Cold extremities", 1, "Subject 7"],
            ["POCT connectivity to EMR helps prevent:", "Testing", "Transcription errors", "Treatment", "Patient discharge", 1, "Subject 7"],
            ["Before performing a POCT, you must:", "Verify patient ID (2 identifiers)", "Eat lunch", "Call the doctor", "Open the window", 0, "Subject 7"],
            ["The first drop of blood in a capillary stick contains:", "Pure blood", "Tissue fluid", "Anticoagulant", "Plasma only", 1, "Subject 7"]
        ];

        // Convert rawData to structured array of objects
        let questionsPool = rawData.map(item => ({
            q: item[0],
            options: [item[1], item[2], item[3], item[4]],
            correct: item[5],
            subject: item[6]
        }));

        // --- State Variables ---
        let currentMode = 'quiz'; 
        let activeQuestions = [];
        let currentIndex = 0;
        let score = 0;
        let wrong = 0;
        let skipped = 0;
        let userHistory = [];
        let startTime = 0;
        let timerInterval = null;
        let stressTimerInterval = null;
        let stressTimeLeft = 0;
        let settings = { soundEnabled: true, effectsEnabled: true };

        const positiveEmojis = ['üéâ', 'üî•', '‚ú®', 'üí™', 'üåü', 'üëè', 'üöÄ', 'üíé'];
        const negativeEmojis = ['üòÆ', 'üìâ', 'ü§î', '‚ùå', 'üö´', 'üìâ', 'üòµ'];
        const skipEmojis = ['‚è≠Ô∏è', 'üèÉ', 'üçÉ', 'ü§∑'];

        // --- Audio Context ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        function playSound(type) {
            if (!settings.soundEnabled) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'correct') {
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(500, audioCtx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.5);
            } else if (type === 'wrong') {
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(150, audioCtx.currentTime);
                oscillator.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.4);
            } else if (type === 'skip') {
                // Whoosh sound
                oscillator.type = 'triangle';
                oscillator.frequency.setValueAtTime(300, audioCtx.currentTime);
                oscillator.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.2);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.001, audioCtx.currentTime + 0.3);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.3);
            } else if (type === 'click') {
                oscillator.type = 'triangle';
                oscillator.frequency.setValueAtTime(300, audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.1);
            } else if (type === 'tick') {
                oscillator.type = 'square';
                oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0.05, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.05);
            }
        }

        // --- UI Logic ---

        function updateRangeVal(val) {
            document.getElementById('q-count-val').innerText = val;
        }

        function selectMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-card').forEach(el => el.classList.remove('selected'));
            document.getElementById(`mode-${mode}`).classList.add('selected');
            playSound('click');
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function triggerFlash(type) {
            if (!settings.effectsEnabled) return;
            const overlay = document.getElementById('flash-overlay');
            overlay.className = ''; 
            void overlay.offsetWidth; 
            overlay.classList.add(type === 'correct' ? 'flash-correct' : (type === 'skip' ? 'flash-skip' : 'flash-wrong'));
        }

        function animateStat(id) {
            const el = document.getElementById(id);
            el.classList.remove('stat-pop');
            void el.offsetWidth;
            el.classList.add('stat-pop');
        }

        function startGame() {
            playSound('click');
            
            const subjectFilter = document.getElementById('subject-select').value;
            let pool = (subjectFilter === 'all') ? [...questionsPool] : questionsPool.filter(q => q.subject === subjectFilter);
            
            pool = shuffleArray(pool);
            const count = parseInt(document.getElementById('q-count-range').value);
            activeQuestions = pool.slice(0, Math.min(count, pool.length));

            if (activeQuestions.length === 0) {
                alert("No questions found for this selection.");
                return;
            }

            currentIndex = 0;
            score = 0;
            wrong = 0;
            skipped = 0;
            userHistory = [];
            document.getElementById('ingame-stats').style.opacity = '1';
            updateStatsDisplay();
            
            document.getElementById('start-screen').classList.remove('active');
            document.getElementById('game-screen').classList.add('active');

            if (currentMode === 'quiz') {
                document.getElementById('quiz-layout').style.display = 'flex';
                document.getElementById('flashcard-layout').style.display = 'none';
            } else {
                document.getElementById('quiz-layout').style.display = 'none';
                document.getElementById('flashcard-layout').style.display = 'flex';
            }

            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);

            loadQuestion();
        }

        function updateTimer() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
            const seconds = (elapsed % 60).toString().padStart(2, '0');
            document.getElementById('timer-display').innerText = `${minutes}:${seconds}`;
        }

        function startStressTimer() {
            if (currentMode !== 'quiz') return;
            
            const durationSetting = parseInt(document.getElementById('timer-select').value);
            const container = document.getElementById('stress-timer-con');
            const bar = document.getElementById('stress-bar');
            
            if (durationSetting === 0) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';
            stressTimeLeft = durationSetting;
            bar.style.width = '100%';
            bar.style.backgroundColor = 'var(--success)';

            if (stressTimerInterval) clearInterval(stressTimerInterval);

            stressTimerInterval = setInterval(() => {
                stressTimeLeft--;
                const percent = (stressTimeLeft / durationSetting) * 100;
                bar.style.width = `${percent}%`;

                if (percent < 50) bar.style.backgroundColor = 'var(--accent)';
                if (percent < 20) {
                    bar.style.backgroundColor = 'var(--error)';
                    playSound('tick'); 
                }

                if (stressTimeLeft <= 0) {
                    clearInterval(stressTimerInterval);
                    skipQuestion(true); 
                }
            }, 1000);
        }

        function updateStatsDisplay() {
            document.getElementById('stat-current').innerText = currentIndex + 1;
            document.getElementById('stat-total').innerText = activeQuestions.length;
            document.getElementById('stat-correct').innerText = score;
            document.getElementById('stat-wrong').innerText = wrong;
            document.getElementById('stat-skipped').innerText = skipped;
        }

        function loadQuestion() {
            const q = activeQuestions[currentIndex];
            
            const progress = ((currentIndex) / activeQuestions.length) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            updateStatsDisplay();

            if (currentMode === 'quiz') {
                renderQuiz(q);
                startStressTimer(); 
            } else {
                renderFlashcard(q);
            }
        }

        function renderQuiz(q) {
            document.getElementById('q-subject').innerText = q.subject;
            document.getElementById('q-text').innerText = q.q;
            
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            document.getElementById('feedback-area').classList.remove('show');
            document.getElementById('next-btn').classList.remove('visible');
            document.getElementById('skip-btn').classList.add('visible'); // Show skip button

            q.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerHTML = `<span>${["A. ", "B. ", "C. ", "D. "][index]} ${opt}</span><span class="key-hint">${["A","B","C","D"][index]}</span>`;
                btn.onclick = () => handleAnswer(index, btn);
                container.appendChild(btn);
            });
        }

        function handleAnswer(selectedIndex, btnElement) {
            const options = document.querySelectorAll('.option-btn');
            options.forEach(o => o.disabled = true);

            if (stressTimerInterval) clearInterval(stressTimerInterval);
            document.getElementById('stress-timer-con').style.display = 'none';

            const currentQ = activeQuestions[currentIndex];
            const isCorrect = (selectedIndex === currentQ.correct);

            if (isCorrect) {
                score++;
                animateStat('stat-correct');
                btnElement.classList.add('correct');
                playSound('correct');
                triggerFlash('correct');
                showFeedback(true, "Correct!", "Keep it up!", positiveEmojis);
            } else {
                wrong++;
                animateStat('stat-wrong');
                btnElement.classList.add('wrong');
                options[currentQ.correct].classList.add('correct');
                playSound('wrong');
                triggerFlash('wrong');
                showFeedback(false, "Incorrect", `Correct answer: ${currentQ.options[currentQ.correct]}`, negativeEmojis);
            }

            userHistory.push({
                q: currentQ.q,
                subject: currentQ.subject,
                userAns: currentQ.options[selectedIndex],
                correctAns: currentQ.options[currentQ.correct],
                isCorrect: isCorrect,
                status: 'Answered'
            });

            document.getElementById('skip-btn').classList.remove('visible'); 
            document.getElementById('next-btn').classList.add('visible');
            document.getElementById('next-btn').focus(); 
        }

        function skipQuestion(isAuto = false) {
            if (stressTimerInterval) clearInterval(stressTimerInterval);
            document.getElementById('stress-timer-con').style.display = 'none';

            skipped++;
            animateStat('stat-skipped');
            
            const currentQ = activeQuestions[currentIndex];
            userHistory.push({
                q: currentQ.q,
                subject: currentQ.subject,
                userAns: "Skipped",
                correctAns: currentQ.options[currentQ.correct],
                isCorrect: false, 
                status: isAuto ? 'Time Out' : 'Skipped'
            });

            if (!isAuto) {
                // Visual feedback only for manual skip
                playSound('skip');
                triggerFlash('skip');
                showFeedback(false, "Skipped", "Moving to the next question.", skipEmojis, 'skip');
                
                // Wait a moment before auto-advancing for manual skip
                setTimeout(() => {
                    currentIndex++;
                    if (currentIndex < activeQuestions.length) {
                        loadQuestion();
                    } else {
                        endGame();
                    }
                }, 1000);
            } else {
                // Immediate skip for timeout
                currentIndex++;
                if (currentIndex < activeQuestions.length) {
                    loadQuestion();
                } else {
                    endGame();
                }
            }
        }

        function showFeedback(isCorrect, title, text, emojiArray, styleType) {
            const fbArea = document.getElementById('feedback-area');
            const randomEmoji = emojiArray[Math.floor(Math.random() * emojiArray.length)];
            
            fbArea.classList.remove('show');
            void fbArea.offsetWidth; 
            fbArea.classList.add('show');
            
            // Remove previous styles
            fbArea.classList.remove('feedback-correct', 'feedback-wrong', 'feedback-skip');
            
            // Add specific style
            if (styleType === 'skip') {
                fbArea.classList.add('feedback-skip');
            } else if (isCorrect) {
                fbArea.classList.add('feedback-correct');
            } else {
                fbArea.classList.add('feedback-wrong');
            }

            document.getElementById('fb-emoji').innerText = randomEmoji;
            document.getElementById('feedback-title').innerText = title;
            document.getElementById('feedback-text').innerText = text;
        }

        function nextQuestion() {
            playSound('click');
            currentIndex++;
            if (currentIndex < activeQuestions.length) {
                loadQuestion();
            } else {
                endGame();
            }
        }

        // --- Keyboard Controls ---
        document.addEventListener('keydown', (e) => {
            if (!document.getElementById('game-screen').classList.contains('active') || currentMode !== 'quiz') return;

            const isAnswered = document.getElementById('next-btn').classList.contains('visible');

            if (!isAnswered) {
                const key = e.key.toLowerCase();
                if (['a', 'b', 'c', 'd'].includes(key)) {
                    const index = key.charCodeAt(0) - 97; 
                    const buttons = document.querySelectorAll('.option-btn');
                    if (buttons[index]) buttons[index].click();
                } else if (key === 's') {
                    // Skip key
                    document.getElementById('skip-btn').click();
                }
            } else {
                if (e.code === 'Space') {
                    e.preventDefault(); 
                    document.getElementById('next-btn').click();
                }
            }
        });

        // --- Flashcard Logic ---
        function renderFlashcard(q) {
            const inner = document.getElementById('flashcard-inner');
            inner.classList.remove('flipped'); 
            
            document.getElementById('fc-subject').innerText = q.subject;
            document.getElementById('fc-question').innerText = q.q;
            document.getElementById('fc-answer').innerText = q.options[q.correct];
        }

        function flipCard() {
            const inner = document.getElementById('flashcard-inner');
            if (!inner.classList.contains('flipped')) {
                playSound('click');
                inner.classList.add('flipped');
            }
        }

        function rateCard(isEasy) {
            playSound('click');
            userHistory.push({
                q: activeQuestions[currentIndex].q,
                subject: activeQuestions[currentIndex].subject,
                userAns: isEasy ? "Easy" : "Hard",
                correctAns: "N/A",
                isCorrect: isEasy
            });
            
            if (isEasy) {
                score++;
                animateStat('stat-correct');
            } else {
                wrong++;
                animateStat('stat-wrong');
            }

            currentIndex++;
            if (currentIndex < activeQuestions.length) {
                loadQuestion();
            } else {
                endGame();
            }
        }

        // --- End Game & Reporting ---
        function endGame() {
            clearInterval(timerInterval);
            clearInterval(stressTimerInterval);
            document.getElementById('game-screen').classList.remove('active');
            document.getElementById('report-screen').classList.add('active');

            const total = activeQuestions.length;
            const attempts = score + wrong;
            const percent = attempts > 0 ? Math.round((score / attempts) * 100) : 0;
            
            document.getElementById('final-percent').innerText = `${percent}%`;
            document.getElementById('final-correct').innerText = score;
            document.getElementById('final-wrong').innerText = wrong;
            document.getElementById('final-skipped').innerText = skipped;

            const list = document.getElementById('report-list');
            list.innerHTML = '';

            userHistory.forEach((item, idx) => {
                const div = document.createElement('div');
                
                // Determine class based on status
                let statusClass = '';
                if (item.isCorrect) statusClass = 'correct';
                else if (item.status === 'Skipped' || item.status === 'Time Out') statusClass = 'skip';
                else statusClass = 'wrong';

                div.className = `report-item ${statusClass}`;
                
                let answerText = "";
                let correctText = "";

                if (currentMode === 'quiz') {
                    answerText = `<div class="report-ans">${item.status}: ${item.userAns}</div>`;
                    if(!item.isCorrect && item.status !== 'Skipped' && item.status !== 'Time Out') {
                        correctText = `<div class="report-ans" style="color:var(--success)">Correct: ${item.correctAns}</div>`;
                    }
                } else {
                    answerText = `<div class="report-ans">Rating: ${item.userAns}</div>`;
                }

                div.innerHTML = `
                    <div class="report-q">${idx + 1}. ${item.q}</div>
                    <div class="report-a">${item.subject}</div>
                    ${answerText}
                    ${correctText}
                `;
                list.appendChild(div);
            });
        }
    </script>
</body>
</html>